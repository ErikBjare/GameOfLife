<html>
	<head>
		<title>Games Of Life</title>
		<link rel="stylesheet" type="text/css" href="style.css">
		<script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
		<script src="misc.js"></script>
	</head>

	<body>
		<canvas id="canvas"></canvas>
		<div style="position: absolute; left: 50%; top: 20px;">
        	<div id="overlay" style="position: relative; left: -50%;">
            	<h1>Game of Life</h1>
        	</div>
    	</div>

		<script type="text/javascript">
			var canvas=document.getElementById("canvas");
			var ctx=canvas.getContext("2d");

			var spawnrate = 0.1

			var cellSize = 8;
			var gridSize = 300;

			var grid = new Array(gridSize);
			for (var i=0; i<gridSize; i++) {
				grid[i] = new Array(gridSize);
				for (var j=0; j<gridSize; j++) {
					grid[i][j] = Math.round(Math.random()-(spawnrate-0.5)) <= 0 ? true:false;
				}
			}

			grid[gridSize/2][gridSize/2] = true
			grid[gridSize/2][gridSize/2+1] = true
			grid[gridSize/2+1][gridSize/2] = true
			grid[gridSize/2+1][gridSize/2+1] = true

			function main() {
				window.addEventListener('resize', resizeCanvas, false);

			    resizeCanvas()

			    nextCycle()
				setInterval(nextCycle, 200);
			}

			function nextCycle() {
				grid = rule_standard(grid)
				draw()
			}

			function neighbors(row, col) {
				return grid[row-1][col-1] + grid[row-1][col] + grid[row-1][col+1] +
					   grid[row][col-1]   +                  + grid[row][col+1]   +
					   grid[row+1][col-1] + grid[row+1][col] + grid[row+1][col+1]
			}

			function rule_standard(grid) {
				newGrid = clone(grid)
				for (var i=1; i<gridSize-1; i++) {
					for (var j=1; j<gridSize-1; j++) {
						n = neighbors(i, j)
						if(newGrid[i][j]) {
							if (n < 2) newGrid[i][j] = false;
							else if (n <= 3) newGrid[i][j] = true;
							else if (n > 3) newGrid[i][j] = false;
						} else {
							if (n == 3) newGrid[i][j] = true;
						}
					}
				}
				return newGrid
			}

			function rule_undead(grid) {
				// Does not care if a cell is alive or not
				newGrid = clone(grid)
				for (var i=1; i<gridSize-1; i++) {
					for (var j=1; j<gridSize-1; j++) {
						n = neighbors(i, j)
						if (n < 2) newGrid[i][j] = false;
						else if (n <= 3) newGrid[i][j] = true;
						else if (n > 3) newGrid[i][j] = false;
					}
				}
				return newGrid
			}

			function output(grid) {
				o = $("#output");
				o.html("");
				for (var row in grid) {
					o.append("[");
					for (var col in grid[row]) {
						if(grid[row][col] == false) {
							o.append("O");
						} else {
							o.append("X");
						}
					}
					o.append("]<br>");
				}
			}

			function draw() {
				clearCanvas()
				ctx.fillStyle="#FFFFFF";
				ctx.strokeStyle="#FFFFFF"

				rows = grid.length
				cols = grid[0].length

				offsetWidth = (canvas.width-cellSize*cols)/2
				offsetHeight = (canvas.height-cellSize*rows)/2

				for (var row in grid) {
					for (var col in grid[row]) {
						if(grid[row][col] == true) {
							ctx.fillStyle="#FFFFFF";
						} else {
							ctx.fillStyle="#000000";
						}
						ctx.fillRect(offsetWidth+row*cellSize+1,  offsetHeight+col*cellSize+1,
										     cellSize-1,    cellSize-1)
					}
				}

				ctx.strokeStyle="#FFFFFF"
				ctx.rect(offsetWidth, offsetHeight,
					     gridSize*cellSize+1, gridSize*cellSize+1);
				ctx.stroke();
			}

			function clearCanvas() {
				offsetWidth = (canvas.width-cellSize*gridSize)/2
				offsetHeight = (canvas.height-cellSize*gridSize)/2

				oldFill = ctx.fillStyle;
				ctx.fillStyle = "#222222";
				ctx.fillRect(offsetWidth, offsetHeight,
					         gridSize*cellSize, gridSize*cellSize);
				ctx.fillStyle = oldFill;
			}

			function resizeCanvas() {
				canvas.width = $("#canvas").width();
				canvas.height = $("#canvas").height();
				draw();
			}

			main()
		</script>
	</body>
</html>